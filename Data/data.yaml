# ==============================================================================
# data.yaml — Central configuration for all agents, markets, and ADMM settings
# ==============================================================================

# ---------------------------------------------------------------------------
# General: Temporal dimensions and reference year
# ---------------------------------------------------------------------------
General:
  nTimesteps: 24       # Hours per representative day (24 = hourly resolution; standard for power-system models)
  nReprDays: 8         # Number of representative days (8 for finer temporal resolution and H2 price analysis)
  nYears: 1            # Number of scenario years (1 = single-year snapshot; >1 enables stochastic / multi-year analysis)
  base_year: 2021      # Calendar year whose timeseries data is used (2021 chosen as a recent year with complete public data)

# ---------------------------------------------------------------------------
# ADMM: Alternating Direction Method of Multipliers global settings
# ---------------------------------------------------------------------------
ADMM:
  rho_initial: 1.0      # Standard starting penalty weight for the augmented Lagrangian; 1.0 is a neutral default that avoids biasing toward primal or dual convergence
  max_iter: 1000       # Iteration budget
  epsilon: 1.0          # Convergence tolerance on L2 norm of primal/dual residuals. With 72 timesteps, epsilon=1 ≈ 0.12 MW per-timestep accuracy (<1% of quantities 20-50 MW).
  min_iter: 0         # Minimum iterations before checking convergence. Early residuals can be spuriously small; 100 ensures prices have stabilized before checking.

# ---------------------------------------------------------------------------
# Market initial prices and penalty weights
# Each market has:
#   initial_price — Scalar seed for the 3D ADMM price array λ[jh,jd,jy].
#                   Chosen as a reasonable starting guess to help ADMM converge
#                   faster by starting near equilibrium.
#   rho_initial   — Per-market ADMM penalty parameter; balances convergence
#                   speed vs. oscillation. Lower values for markets needing
#                   gentler convergence (e.g. GC markets with smaller volumes).
# ---------------------------------------------------------------------------
elec_market:
  initial_price: 80.0   # €/MWh — Warm-start from social planner equilibrium
  rho_initial: 1.0      # Penalty weight for electricity; 1.0 matches the global default (largest, most liquid market)
elec_GC_market:
  initial_price: 10.0   # €/MWh_GC — Warm-start from social planner equilibrium
  rho_initial: 0.3      # Lower penalty: GC market has smaller volumes & price ranges; gentler convergence avoids oscillation
H2_market:
  initial_price: 122.0  # €/MWh_H2 — Warm-start from social planner equilibrium
  rho_initial: 0.5      # Moderate penalty: H2 market is tightly coupled to electricity through the electrolyzer
H2_GC_market:
  initial_price: 0.0    # €/MWh_GC — Warm-start from social planner equilibrium
  rho_initial: 1.0      # Moderate penalty: H2_GC is now hourly, needs stronger consensus pressure than a thin annual market

# ---------------------------------------------------------------------------
# EP (End-Product) market — Coordination market for ammonia / downstream product
# ---------------------------------------------------------------------------
EP_market:
  initial_price: 144.0      # €/MWh_EP — Warm-start from social planner equilibrium
  rho_initial: 3.0          # Larger penalty: EP market is stiff (few participants, large price swings) and needs stronger coupling
  Demand_Column: "LOAD_EP"  # Column in the timeseries CSV that holds the normalized EP demand profile (inelastic)
  Total_Demand: 40.0        # EP demand scaling factor (MWh_EP); D_EP[jh,jd,jy] = Total_Demand × LOAD_EP. With LOAD_EP ≈ 0.9 → D_EP ≈ 36/h, within total capacity (50 MW)
#Basically 36 MW_EP per hour is demanded.
# ---------------------------------------------------------------------------
# Power-sector agents
# ---------------------------------------------------------------------------
Power:
  # Variable Renewable Energy Source (solar farm)
  Gen_VRES_01:
    Type: "VRES"
    Capacity: 100.0            # Installed capacity (MW); reduced from 150 MW to tighten supply and make endogenous investment margins more relevant.
    Profile_Column: "SOLAR"    # Column in timeseries CSV with hourly capacity factors (0–1) for this VRES unit
    MarginalCost: 0.0          # €/MWh — Zero marginal cost: no fuel; incentivises full dispatch whenever available
    FixedCost_per_MW: 70000.0  # €/MW-year — Annualised CAPEX + fixed O&M for utility-scale solar. Assumes ≈700 k€/MW CAPEX, 20-year lifetime, 8% WACC; annuity factor ≈0.10 ⇒ ≈70 k€/MW-year, consistent with recent LCOE studies.
    gamma: 0.0                 # Risk weight for CVaR (γ=0 ⇒ risk-neutral even though risk terms are present structurally).
    beta: 0.95                 # CVaR confidence level τ (placeholder; only active when gamma>0).

  # Dispatchable conventional generator (e.g. gas turbine)
  Gen_Conv_01:
    Type: "Conventional"
    Capacity: 50.0           # Installed capacity (MW); always available (AF = 1)
    MarginalCost: 60.0       # €/MWh — Fuel + O&M cost; sets the price floor when VRES cannot meet demand

  # Electricity consumer with elastic (quadratic) demand
  # Quadratic utility: U(d) = A_E·d − ½·B_E·d²  →  inverse demand p(d) = A_E − B_E·d
  Cons_Elec_01:
    Type: "Consumer"
    PeakLoad: 40.0           # Peak demand (MW); scales the normalized load profile to absolute MW values
    Load_Column: "LOAD_E"    # Column in timeseries CSV with the normalized electricity load profile
    A_E: 500.0               # €/MWh — Intercept of inverse demand curve; willingness to pay for the first MW (high to ensure demand is met)
    B_E: 0.5                 # €/MWh² — Slope of inverse demand; controls price sensitivity (low = relatively inelastic demand)

# ---------------------------------------------------------------------------
# Hydrogen producers (electrolysis)
# ---------------------------------------------------------------------------
Hydrogen:
  Prod_H2_Green:
    Type: "GreenProducer"
    Capacity_Electrolyzer: 60.0               # Maximum electricity input to the electrolyzer (MW_elec); reduced from 90 MW to tighten initial supply and make investment decisions more relevant.
    Capacity_H2_Output: 40.0                  # Maximum hydrogen output (MW_H2); aligned with the 60 MW_elec limit (60 / 1.5 = 40 MW_H2) after reduction.
    SpecificConsumption: 1.5                 # MWh_elec per MWh_H2 produced (i.e. efficiency = 1/1.5 ≈ 67%); typical PEM electrolyzer value
    OperationalCost: 3.0                     # €/MWh_H2 — Variable O&M for water treatment, stack degradation, etc.
    FixedCost_per_MW_Electrolyzer: 100000.0  # €/MW_elec-year — Annualised CAPEX for PEM electrolysers. Assumes ≈1.0 M€/MW CAPEX, 20-year lifetime, 8% WACC; annuity factor ≈0.10 ⇒ ≈100 k€/MW-year (within IEA/IEEFA benchmark ranges).
    gamma: 0.0                 # Risk weight for CVaR (γ=0 ⇒ risk-neutral baseline).
    beta: 0.95                 # CVaR confidence level τ.

# ---------------------------------------------------------------------------
# Hydrogen offtakers (downstream processors & importers)
# ---------------------------------------------------------------------------
Hydrogen_Offtaker:
  # Green offtaker — converts H2 into end product using only green hydrogen
  Offtaker_Green:
    Type: "GreenOfftaker"
    Capacity_H2_In: 40.0               # Max H2 intake (MW_H2); reduced in line with the producer, matched to the new 40 MW_H2 output capacity.
    Capacity_EP_Out: 30.0              # Max end-product output (MW_EP equivalent); updated consistently: Alpha * Capacity_H2_In = 0.75 * 40 = 30 MW_EP.
    Alpha: 0.75                        # H2-to-EP conversion ratio (MWh_EP per MWh_H2). 0.75 means 1 MWh_H2 yields 0.75 MWh_EP of NH3, consistent with typical industrial Haber–Bosch efficiencies (≈70–80% on an LHV basis).
    ProcessingCost: 7.0                # €/MWh_EP — Cost of converting H2 to end product (energy, catalysts, labour)
    FixedCost_per_MW_EP_Out: 120000.0  # €/MW_EP-year — Annualised CAPEX for downstream synthesis/processing (e.g. ammonia plant). Assumes ≈1.2 M€/MW_EP CAPEX, 20-year lifetime, 8% WACC; annuity factor ≈0.10 ⇒ ≈120 k€/MW-year.
    gamma: 0.0                 # Risk weight for CVaR (γ=0 ⇒ risk-neutral baseline).
    beta: 0.95                 # CVaR confidence level τ.

  # Grey offtaker — uses conventional (grey) hydrogen but must buy H2 GCs for a fraction of its implied H2 use
  Offtaker_Grey:
    Type: "GreyOfftaker"
    Capacity: 30.0            # Max end-product output (MW_EP equivalent); together with 45 MW_EP green capacity and 5 MW_EP import, total EP supply capacity (≈80 MW_EP) now comfortably exceeds ≈36 MW_EP demand while preserving headroom for competition between green and grey routes.
    MarginalCost: 100.0       # €/MWh_EP — Higher than green because it includes fossil H2 + carbon costs
    gamma_NH3: 0.75           # EP-to-H2 conversion ratio for grey offtaker (MWh_EP per MWh_H2). 0.75 means 1 MWh_H2 yields 0.75 MWh_EP of NH3; we infer implied H2 use from observed EP output via H2_intake ≈ EP / gamma_NH3 when applying the 42% green H2 GC mandate.

  # EP importer — brings end product from outside the modelled system
  Offtaker_Import:
    Type: "EPImporter"
    Capacity: 5.0             # Max import volume (MW_EP equivalent); limited by logistics / contracts
    ImportCost: 1800.0        # €/MWh_EP — High import cost representing transport + foreign production; acts as price cap

# ---------------------------------------------------------------------------
# Electricity Guarantees-of-Origin (GC) demand agent
# Quadratic utility: U(d) = A_GC·d − ½·B_GC·d²  →  inverse demand p(d) = A_GC − B_GC·d
# (Same functional form as the electricity consumer, applied to GC certificates)
# ---------------------------------------------------------------------------
Electricity_GC_Demand:
  Demand_GC_Elec_01:
    Type: "GC_Demand"
    PeakLoad: 10.0           # Peak GC demand (MW_GC equivalent); scales the normalized load profile
    Load_Column: "LOAD_E"    # Reuses the electricity load profile as a proxy for GC demand timing
    A_GC: 20.0               # €/MWh_GC — Intercept of inverse demand for GCs; willingness to pay for first certificate
    B_GC: 0.5                # €/MWh_GC² — Slope; controls price sensitivity of GC demand

# ---------------------------------------------------------------------------
# EP Demand — Currently empty: EP demand is inelastic and fully defined by
# EP_market.Total_Demand × normalized profile. This block is a placeholder
# for future elastic EP demand agents.
# ---------------------------------------------------------------------------
EP_Demand: {}